# üìä T√†i li·ªáu API Th·ªëng k√™ S√°ch - Book Statistics

## T·ªïng quan

H·ªá th·ªëng th·ªëng k√™ s√°ch ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi 2 t·∫ßng (tier) ƒë·ªÉ t·ªëi ∆∞u hi·ªáu nƒÉng:

- **Tier 1 (Summary)**: D·ªØ li·ªáu t·ªïng quan nh·∫π cho bi·ªÉu ƒë·ªì
- **Tier 2 (Details)**: Chi ti·∫øt khi user click v√†o ƒëi·ªÉm c·ª• th·ªÉ

## 1. API Th·ªëng k√™ T·ªïng quan (Tier 1)

### üìç Endpoint
```
GET /api/books/statistics/summary
```

### üéØ M·ª•c ƒë√≠ch
Tr·∫£ v·ªÅ d·ªØ li·ªáu nh·∫π cho chart overview - ch·ªâ t·ªïng s·ªë s√°ch b√°n theo th·ªùi gian

### üì• Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| period | String | No | "day" | Lo·∫°i kho·∫£ng th·ªùi gian |
| fromDate | Long | No | null | Timestamp b·∫Øt ƒë·∫ßu (milliseconds) |
| toDate | Long | No | null | Timestamp k·∫øt th√∫c (milliseconds) |

### üîß Quy t·∫Øc Period v√† Date Range

#### Period Types
- **day**: Th·ªëng k√™ theo ng√†y
- **week**: Th·ªëng k√™ theo tu·∫ßn  
- **month**: Th·ªëng k√™ theo th√°ng
- **quarter**: Th·ªëng k√™ theo qu√Ω
- **year**: Th·ªëng k√™ theo nƒÉm
- **custom**: Kho·∫£ng th·ªùi gian t√πy ch·ªânh

### üîç Chi ti·∫øt x·ª≠ l√Ω fromDate-toDate v·ªõi Period

Khi c√≥ `fromDate` v√† `toDate`, h·ªá th·ªëng s·∫Ω:
1. **Validate kho·∫£ng th·ªùi gian h·ª£p l·ªá** 
2. **Chia kho·∫£ng th·ªùi gian theo period**
3. **Ki·ªÉm tra ƒë·ªô d√†i t·ªëi thi·ªÉu cho m·ªói period**
4. **Tr·∫£ v·ªÅ data points ho·∫∑c error**

#### üéØ Logic x·ª≠ l√Ω t·ª´ng Period Type

#### Lu·ªìng x·ª≠ l√Ω Date Range

```mermaid
graph TD
    A[Request v·ªõi period + fromDate + toDate] --> B{Validate dates}
    
    B -->|Invalid| B1[Error: Invalid date range]
    B -->|Valid| C[T√≠nh duration = toDate - fromDate]
    
    C --> D{period = 'day'?}
    
    D -->|Yes| D1{duration >= 1 day?}
    D1 -->|No| D2[Error: Minimum 1 day required]
    D1 -->|Yes| D3[Chia th√†nh c√°c ng√†y t·ª´ fromDate ƒë·∫øn toDate]
    D3 --> D4[Tr·∫£ v·ªÅ array data points theo ng√†y]
    
    D -->|No| E{period = 'week'?}
    E -->|Yes| E1{duration >= 7 days?}
    E1 -->|No| E2[Error: Minimum 1 week required]
    E1 -->|Yes| E3[Chia th√†nh c√°c tu·∫ßn, b·∫Øt ƒë·∫ßu t·ª´ th·ª© 2]
    E3 --> E4[Tr·∫£ v·ªÅ array data points theo tu·∫ßn]
    
    E -->|No| F{period = 'month'?}
    F -->|Yes| F1{duration >= 1 month?}
    F1 -->|No| F2[Error: Minimum 1 month required]
    F1 -->|Yes| F3[Chia th√†nh c√°c th√°ng t·ª´ ng√†y 1]
    F3 --> F4[Tr·∫£ v·ªÅ array data points theo th√°ng]
    
    F -->|No| G{period = 'quarter'?}
    G -->|Yes| G1{duration >= 3 months?}
    G1 -->|No| G2[Error: Minimum 1 quarter required]
    G1 -->|Yes| G3[Chia th√†nh c√°c qu√Ω Q1,Q2,Q3,Q4]
    G3 --> G4[Tr·∫£ v·ªÅ array data points theo qu√Ω]
    
    G -->|No| H{period = 'year'?}
    H -->|Yes| H1{duration >= 365 days?}
    H1 -->|No| H2[Error: Minimum 1 year required]
    H1 -->|Yes| H3[Chia th√†nh c√°c nƒÉm t·ª´ 1/1]
    H3 --> H4[Tr·∫£ v·ªÅ array data points theo nƒÉm]
    
    H -->|No| I[Custom: S·ª≠ d·ª•ng to√†n b·ªô range]
    I --> I1[Tr·∫£ v·ªÅ 1 data point duy nh·∫•t]
```

### üìä Chi ti·∫øt x·ª≠ l√Ω t·ª´ng lo·∫°i Period

#### 1Ô∏è‚É£ PERIOD = "day"
```javascript
// Input: fromDate=1722470400000 (2025-08-01), toDate=1722816000000 (2025-08-05)
// Duration: 4 ng√†y
// Expected output: 4 data points

[
  {
    "period": "2025-08-01",
    "timestamp": 1722470400000,
    "startTime": 1722470400000,  // 2025-08-01 00:00:00
    "endTime": 1722556799999,    // 2025-08-01 23:59:59
    "totalBooksSold": 45,
    "totalRevenue": 1250000
  },
  {
    "period": "2025-08-02", 
    "timestamp": 1722556800000,
    "startTime": 1722556800000,  // 2025-08-02 00:00:00
    "endTime": 1722643199999,    // 2025-08-02 23:59:59
    "totalBooksSold": 32,
    "totalRevenue": 980000
  },
  // ... ti·∫øp t·ª•c cho 2025-08-03, 2025-08-04
]

// ‚ùå CASE L·ªñI: fromDate=1722470400000, toDate=1722480000000 (ch·ªâ 2.7 gi·ªù)
{
  "status": 400,
  "message": "Period 'day' requires minimum 1 day duration. Current: 2.7 hours",
  "data": null,
  "minDurationRequired": "1 day",
  "actualDuration": "2.7 hours"
}
```

#### 2Ô∏è‚É£ PERIOD = "week"
```javascript
// Input: fromDate=1722470400000 (2025-08-01 Fri), toDate=1724889600000 (2025-08-29 Fri) 
// Duration: 28 ng√†y = 4 tu·∫ßn
// Expected output: 4 data points (tu·∫ßn b·∫Øt ƒë·∫ßu t·ª´ th·ª© 2)

[
  {
    "period": "2025-W31",               // Tu·∫ßn 31 nƒÉm 2025
    "timestamp": 1722297600000,         // Monday c·ªßa tu·∫ßn ƒë√≥
    "startTime": 1722297600000,         // 2025-07-29 00:00:00 (Monday)
    "endTime": 1722902399999,           // 2025-08-04 23:59:59 (Sunday)
    "totalBooksSold": 124,
    "totalRevenue": 3450000,
    "daysInPeriod": 7,
    "partialWeek": true                 // V√¨ fromDate kh√¥ng ph·∫£i th·ª© 2
  },
  {
    "period": "2025-W32",
    "timestamp": 1722902400000,         // 2025-08-05 00:00:00 
    "startTime": 1722902400000,         // 2025-08-05 00:00:00 (Monday)
    "endTime": 1723507199999,           // 2025-08-11 23:59:59 (Sunday)
    "totalBooksSold": 156,
    "totalRevenue": 4120000,
    "daysInPeriod": 7,
    "partialWeek": false                // Tu·∫ßn ƒë·∫ßy ƒë·ªß
  },
  // ... W33, W34
]

// ‚ùå CASE L·ªñI: fromDate=1722470400000, toDate=1722902400000 (5 ng√†y)
{
  "status": 400,
  "message": "Period 'week' requires minimum 7 days duration. Current: 5 days",
  "data": null,
  "minDurationRequired": "7 days",
  "actualDuration": "5 days",
  "suggestion": "Use period='day' for shorter durations"
}
```

#### 3Ô∏è‚É£ PERIOD = "month"
```javascript
// Input: fromDate=1722470400000 (2025-08-01), toDate=1730419200000 (2025-11-01)
// Duration: 3 th√°ng 
// Expected output: 3 data points

[
  {
    "period": "2025-08",
    "timestamp": 1722470400000,         // 2025-08-01 00:00:00
    "startTime": 1722470400000,         // 2025-08-01 00:00:00  
    "endTime": 1725148799999,           // 2025-08-31 23:59:59
    "totalBooksSold": 892,
    "totalRevenue": 25600000,
    "daysInPeriod": 31
  },
  {
    "period": "2025-09",
    "timestamp": 1725148800000,         // 2025-09-01 00:00:00
    "startTime": 1725148800000,         // 2025-09-01 00:00:00
    "endTime": 1727827199999,           // 2025-09-30 23:59:59  
    "totalBooksSold": 756,
    "totalRevenue": 22100000,
    "daysInPeriod": 30
  },
  {
    "period": "2025-10", 
    "timestamp": 1727827200000,         // 2025-10-01 00:00:00
    "startTime": 1727827200000,         // 2025-10-01 00:00:00
    "endTime": 1730419199999,           // 2025-10-31 23:59:59
    "totalBooksSold": 623,
    "totalRevenue": 18900000,
    "daysInPeriod": 31
  }
]

// ‚ùå CASE L·ªñI: fromDate=2025-08-01, toDate=2025-08-15 (15 ng√†y)
{
  "status": 400,
  "message": "Period 'month' requires minimum 1 month duration. Current: 15 days", 
  "data": null,
  "minDurationRequired": "30 days",
  "actualDuration": "15 days",
  "suggestion": "Use period='day' or extend date range to at least 30 days"
}
```

#### 4Ô∏è‚É£ PERIOD = "quarter" 
```javascript
// Input: fromDate=1704067200000 (2024-01-01), toDate=1735689600000 (2025-01-01)
// Duration: 1 nƒÉm = 4 qu√Ω
// Expected output: 4 data points

[
  {
    "period": "2024-Q1",
    "timestamp": 1704067200000,         // 2024-01-01 00:00:00
    "startTime": 1704067200000,         // 2024-01-01 00:00:00
    "endTime": 1711929599999,           // 2024-03-31 23:59:59
    "totalBooksSold": 2156,
    "totalRevenue": 65400000,
    "monthsInPeriod": 3,
    "months": ["Jan", "Feb", "Mar"]
  },
  {
    "period": "2024-Q2", 
    "timestamp": 1711929600000,         // 2024-04-01 00:00:00
    "startTime": 1711929600000,         // 2024-04-01 00:00:00
    "endTime": 1719791999999,           // 2024-06-30 23:59:59
    "totalBooksSold": 1987,
    "totalRevenue": 58900000,
    "monthsInPeriod": 3,
    "months": ["Apr", "May", "Jun"]
  },
  // ... Q3, Q4
]

// ‚ùå CASE L·ªñI: fromDate=2025-01-01, toDate=2025-02-28 (2 th√°ng)
{
  "status": 400,
  "message": "Period 'quarter' requires minimum 3 months duration. Current: 2 months",
  "data": null,
  "minDurationRequired": "90 days",
  "actualDuration": "58 days", 
  "suggestion": "Use period='month' or extend date range to at least 90 days"
}
```

#### 5Ô∏è‚É£ PERIOD = "year"
```javascript
// Input: fromDate=1672531200000 (2023-01-01), toDate=1735689600000 (2025-01-01)  
// Duration: 2 nƒÉm
// Expected output: 2 data points

[
  {
    "period": "2023",
    "timestamp": 1672531200000,         // 2023-01-01 00:00:00
    "startTime": 1672531200000,         // 2023-01-01 00:00:00  
    "endTime": 1704067199999,           // 2023-12-31 23:59:59
    "totalBooksSold": 8956,
    "totalRevenue": 245600000,
    "daysInPeriod": 365,
    "isLeapYear": false
  },
  {
    "period": "2024",
    "timestamp": 1704067200000,         // 2024-01-01 00:00:00
    "startTime": 1704067200000,         // 2024-01-01 00:00:00
    "endTime": 1735689599999,           // 2024-12-31 23:59:59
    "totalBooksSold": 9234,
    "totalRevenue": 267800000,
    "daysInPeriod": 366,
    "isLeapYear": true
  }
]

// ‚ùå CASE L·ªñI: fromDate=2025-01-01, toDate=2025-11-01 (10 th√°ng)
{
  "status": 400,
  "message": "Period 'year' requires minimum 12 months duration. Current: 10 months",
  "data": null,
  "minDurationRequired": "365 days",
  "actualDuration": "304 days",
  "suggestion": "Use period='quarter' or period='month', or extend date range to at least 365 days"
}
```

### üö® C√°c tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát v√† Error Handling

#### Case 1: Kh√¥ng ƒë·ªß ƒë∆°n v·ªã th·ªùi gian
```javascript
// Request: period=week, fromDate=2025-08-01, toDate=2025-08-05 (5 ng√†y)
{
  "status": 400,
  "message": "Period 'week' requires minimum 7 days. Current range is only 5 days",
  "data": null,
  "details": {
    "requestedPeriod": "week",
    "minDurationRequired": "7 days",
    "actualDuration": "5 days",
    "fromDate": "2025-08-01T00:00:00Z",
    "toDate": "2025-08-05T00:00:00Z",
    "suggestions": [
      "Extend toDate to at least 2025-08-08",
      "Use period='day' for shorter durations"
    ]
  }
}
```

#### Case 2: Kho·∫£ng th·ªùi gian l·∫ª - kh√¥ng chia ƒë·ªÅu
```javascript
// Request: period=month, fromDate=2025-08-15, toDate=2025-11-10 (2.8 th√°ng)
// System s·∫Ω chia th√†nh c√°c th√°ng v√† x·ª≠ l√Ω th√°ng ƒë·∫ßu/cu·ªëi b·ªã c·∫Øt

[
  {
    "period": "2025-08",
    "timestamp": 1723680000000,         // 2025-08-15 00:00:00 (startTime actual)
    "startTime": 1723680000000,         // 2025-08-15 00:00:00 (kh√¥ng ph·∫£i ng√†y 1)
    "endTime": 1725148799999,           // 2025-08-31 23:59:59
    "totalBooksSold": 456,              // Ch·ªâ t√≠nh t·ª´ 15/8
    "totalRevenue": 12800000,
    "daysInPeriod": 17,                 // 17 ng√†y (kh√¥ng ph·∫£i 31)
    "isPartialPeriod": true,
    "partialInfo": {
      "type": "start_partial",
      "missingDays": 14                 // Thi·∫øu 14 ng√†y ƒë·∫ßu th√°ng
    }
  },
  {
    "period": "2025-09", 
    "timestamp": 1725148800000,         // 2025-09-01 00:00:00
    "startTime": 1725148800000,         // 2025-09-01 00:00:00
    "endTime": 1727827199999,           // 2025-09-30 23:59:59
    "totalBooksSold": 789,              // Th√°ng ƒë·∫ßy ƒë·ªß
    "totalRevenue": 22100000,
    "daysInPeriod": 30,
    "isPartialPeriod": false
  },
  {
    "period": "2025-10",
    "timestamp": 1727827200000,         // 2025-10-01 00:00:00  
    "startTime": 1727827200000,         // 2025-10-01 00:00:00
    "endTime": 1728518399999,           // 2025-10-10 23:59:59 (kh√¥ng ph·∫£i 31)
    "totalBooksSold": 234,              // Ch·ªâ t√≠nh ƒë·∫øn 10/10
    "totalRevenue": 6700000,
    "daysInPeriod": 10,                 // 10 ng√†y (kh√¥ng ph·∫£i 31)
    "isPartialPeriod": true,
    "partialInfo": {
      "type": "end_partial", 
      "missingDays": 21                 // Thi·∫øu 21 ng√†y cu·ªëi th√°ng
    }
  }
]
```

#### Case 3: Kh√¥ng c√≥ d·ªØ li·ªáu trong kho·∫£ng th·ªùi gian
```javascript
// C√°c data point v·∫´n ƒë∆∞·ª£c tr·∫£ v·ªÅ nh∆∞ng v·ªõi gi√° tr·ªã 0
[
  {
    "period": "2025-08-01",
    "timestamp": 1722470400000,
    "totalBooksSold": 0,               // Kh√¥ng c√≥ ƒë∆°n h√†ng
    "totalRevenue": 0,
    "totalOrders": 0,
    "hasData": false                   // Flag ƒë·ªÉ frontend bi·∫øt
  }
]
```

#### Case 4: fromDate > toDate
```javascript
{
  "status": 400,
  "message": "fromDate must be less than toDate",
  "data": null,
  "details": {
    "fromDate": "2025-08-10T00:00:00Z",
    "toDate": "2025-08-05T00:00:00Z",
    "difference": "-5 days"
  }
}
```

#### Case 5: Kho·∫£ng th·ªùi gian qu√° l·ªõn
```javascript
// Request: period=day, fromDate=2020-01-01, toDate=2025-12-31 (6 nƒÉm = 2191 data points)
{
  "status": 400,
  "message": "Date range too large for period 'day'. Maximum 365 data points allowed",
  "data": null,
  "details": {
    "requestedDataPoints": 2191,
    "maxDataPointsAllowed": 365,
    "suggestion": "Use period='week' or 'month' for longer date ranges"
  }
}
```

### üìè Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng data points

| Period | Max Data Points | Max Duration | 
|--------|-----------------|--------------|
| day | 365 | 1 nƒÉm |
| week | 104 | 2 nƒÉm | 
| month | 60 | 5 nƒÉm |
| quarter | 40 | 10 nƒÉm |
| year | 20 | 20 nƒÉm |

### üì§ Response Format

```json
{
  "status": 200,
  "message": "Th·ªëng k√™ t·ªïng quan th√†nh c√¥ng",
  "data": [
    {
      "period": "2025-08-01",          // Nh√£n th·ªùi gian
      "timestamp": 1722470400000,      // Timestamp ƒë·ªÉ details API
      "totalBooksSold": 150,           // T·ªïng s·ªë s√°ch b√°n
      "totalRevenue": 2500000,         // T·ªïng doanh thu (optional)
      "totalOrders": 45                // T·ªïng s·ªë ƒë∆°n h√†ng (optional)
    },
    {
      "period": "2025-08-02",
      "timestamp": 1722556800000,
      "totalBooksSold": 200,
      "totalRevenue": 3200000,
      "totalOrders": 62
    }
  ]
}
```

### üî• V√≠ d·ª• s·ª≠ d·ª•ng

#### 1. Th·ªëng k√™ 30 ng√†y g·∫ßn nh·∫•t
```http
GET /api/books/statistics/summary?period=day
```

#### 2. Th·ªëng k√™ 12 th√°ng g·∫ßn nh·∫•t  
```http
GET /api/books/statistics/summary?period=month
```

#### 3. Th·ªëng k√™ kho·∫£ng th·ªùi gian t√πy ch·ªânh
```http
GET /api/books/statistics/summary?period=custom&fromDate=1722470400000&toDate=1725148800000
```

---

## 2. API Th·ªëng k√™ Chi ti·∫øt (Tier 2)

### üìç Endpoint
```
GET /api/books/statistics/details
```

### üéØ M·ª•c ƒë√≠ch
Tr·∫£ v·ªÅ top s√°ch chi ti·∫øt khi user click v√†o ƒëi·ªÉm c·ª• th·ªÉ tr√™n chart

### üì• Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| period | String | Yes | - | Lo·∫°i kho·∫£ng th·ªùi gian (day/week/month/year) |
| date | Long | Yes | - | Timestamp ƒë·∫°i di·ªán cho kho·∫£ng th·ªùi gian |
| limit | Integer | No | 10 | S·ªë l∆∞·ª£ng s√°ch mu·ªën l·∫•y |

### üîß Quy t·∫Øc x·ª≠ l√Ω Period v√† Date

#### Lu·ªìng x·ª≠ l√Ω

```mermaid
graph TD
    A[Request v·ªõi period & date] --> B[Parse timestamp]
    
    B --> C{period = 'day'?}
    C -->|Yes| D[L·∫•y d·ªØ li·ªáu t·ª´ 00:00 - 23:59 c·ªßa ng√†y ƒë√≥]
    
    C -->|No| E{period = 'week'?}
    E -->|Yes| F[T√≠nh to√°n tu·∫ßn ch·ª©a timestamp<br/>T·ª´ Th·ª© 2 - Ch·ªß nh·∫≠t]
    
    E -->|No| G{period = 'month'?}
    G -->|Yes| H[T√≠nh to√°n th√°ng ch·ª©a timestamp<br/>T·ª´ ng√†y 1 - ng√†y cu·ªëi th√°ng]
    
    G -->|No| I{period = 'year'?}
    I -->|Yes| J[T√≠nh to√°n nƒÉm ch·ª©a timestamp<br/>T·ª´ 1/1 - 31/12]
    
    D --> K[Query top books trong kho·∫£ng th·ªùi gian]
    F --> K
    H --> K
    J --> K
    
    K --> L[S·∫Øp x·∫øp theo s·ªë l∆∞·ª£ng b√°n DESC]
    L --> M[Limit k·∫øt qu·∫£]
    M --> N[Tr·∫£ v·ªÅ danh s√°ch books]
```

### üì§ Response Format

```json
{
  "status": 200,
  "message": "L·∫•y chi ti·∫øt th·ªëng k√™ th√†nh c√¥ng",
  "data": [
    {
      "bookId": 101,
      "bookName": "S√°ch A",
      "bookCode": "BOOK001",
      "coverImage": "image_url",
      "price": 150000,
      "discountPrice": 120000,
      "quantitySold": 25,
      "revenue": 3000000,
      "orderCount": 15,
      "categoryName": "VƒÉn h·ªçc",
      "authorName": "T√°c gi·∫£ A"
    },
    {
      "bookId": 102,
      "bookName": "S√°ch B", 
      "bookCode": "BOOK002",
      "coverImage": "image_url",
      "price": 200000,
      "discountPrice": 180000,
      "quantitySold": 20,
      "revenue": 3600000,
      "orderCount": 12,
      "categoryName": "Khoa h·ªçc",
      "authorName": "T√°c gi·∫£ B"
    }
  ]
}
```

### üî• V√≠ d·ª• s·ª≠ d·ª•ng

#### 1. Chi ti·∫øt top 10 s√°ch b√°n ch·∫°y trong ng√†y 01/08/2025
```http
GET /api/books/statistics/details?period=day&date=1722470400000&limit=10
```

#### 2. Chi ti·∫øt top 5 s√°ch b√°n ch·∫°y trong th√°ng 8/2025
```http
GET /api/books/statistics/details?period=month&date=1722470400000&limit=5
```

#### 3. Chi ti·∫øt top 20 s√°ch b√°n ch·∫°y trong tu·∫ßn ch·ª©a ng√†y 15/08/2025
```http
GET /api/books/statistics/details?period=week&date=1723680000000&limit=20
```

---

## 3. Lu·ªìng t∆∞∆°ng t√°c Frontend - Backend

### üìà K·ªãch b·∫£n s·ª≠ d·ª•ng ƒëi·ªÉn h√¨nh

```mermaid
sequenceDiagram
    participant FE as Frontend
    participant BE as Backend
    participant DB as Database
    
    Note over FE,BE: Phase 1: Load Chart Overview
    
    FE->>BE: GET /api/books/statistics/summary?period=month
    BE->>DB: Query monthly book sales summary
    DB->>BE: Return aggregated data points
    BE->>FE: Return summary data for chart
    
    Note over FE: User sees chart with data points
    
    Note over FE,BE: Phase 2: User clicks on specific point
    
    FE->>BE: GET /api/books/statistics/details?period=month&date=1722470400000&limit=10
    BE->>DB: Query detailed books for that month
    DB->>BE: Return top 10 books with details
    BE->>FE: Return detailed book list
    
    Note over FE: User sees popup/modal with book details
```

### üîÑ Lu·ªìng chuy·ªÉn ƒë·ªïi Period

```mermaid
graph LR
    A[User ch·ªçn Day] --> B[G·ªçi summary API v·ªõi period=day]
    B --> C[Hi·ªÉn th·ªã chart 30 ng√†y]
    C --> D[User click v√†o ng√†y c·ª• th·ªÉ]
    D --> E[G·ªçi details API v·ªõi period=day & date=timestamp]
    
    F[User ch·ªçn Month] --> G[G·ªçi summary API v·ªõi period=month] 
    G --> H[Hi·ªÉn th·ªã chart 12 th√°ng]
    H --> I[User click v√†o th√°ng c·ª• th·ªÉ]
    I --> J[G·ªçi details API v·ªõi period=month & date=timestamp]
```

---

## 4. Quy t·∫Øc Business Logic

### üìä T√≠nh to√°n Period Range

#### Day Period
- **Summary**: L·∫•y 30 ng√†y g·∫ßn nh·∫•t t·ª´ h√¥m nay
- **Details**: T·ª´ 00:00:00 ƒë·∫øn 23:59:59 c·ªßa ng√†y ƒë∆∞·ª£c ch·ªçn

#### Week Period  
- **Summary**: L·∫•y 12 tu·∫ßn g·∫ßn nh·∫•t t·ª´ tu·∫ßn hi·ªán t·∫°i
- **Details**: T·ª´ Th·ª© 2 00:00:00 ƒë·∫øn Ch·ªß nh·∫≠t 23:59:59 c·ªßa tu·∫ßn ch·ª©a timestamp

#### Month Period
- **Summary**: L·∫•y 12 th√°ng g·∫ßn nh·∫•t t·ª´ th√°ng hi·ªán t·∫°i  
- **Details**: T·ª´ ng√†y 1 00:00:00 ƒë·∫øn ng√†y cu·ªëi th√°ng 23:59:59

#### Year Period
- **Summary**: L·∫•y 5 nƒÉm g·∫ßn nh·∫•t t·ª´ nƒÉm hi·ªán t·∫°i
- **Details**: T·ª´ 1/1 00:00:00 ƒë·∫øn 31/12 23:59:59

#### Custom Period
- **Summary**: S·ª≠ d·ª•ng fromDate v√† toDate ƒë∆∞·ª£c cung c·∫•p
- **Details**: Kh√¥ng √°p d·ª•ng (custom ch·ªâ d√πng cho summary)

### üîÑ Validation Rules

#### Summary API
1. N·∫øu `period = "custom"` ‚Üí `fromDate` v√† `toDate` b·∫Øt bu·ªôc
2. `fromDate` ph·∫£i < `toDate` 
3. Kho·∫£ng c√°ch t·ªëi ƒëa: 2 nƒÉm
4. Default period = "day" n·∫øu kh√¥ng cung c·∫•p

#### Details API  
1. `period` v√† `date` b·∫Øt bu·ªôc
2. `period` kh√¥ng ƒë∆∞·ª£c l√† "custom"
3. `limit` trong kho·∫£ng 1-100
4. `date` ph·∫£i l√† timestamp h·ª£p l·ªá

---

## 5. Performance & Caching

### üöÄ T·ªëi ∆∞u hi·ªáu nƒÉng

#### Summary API
- Cache k·∫øt qu·∫£ 15 ph√∫t cho period c·ªë ƒë·ªãnh (day, week, month, year)
- Custom period kh√¥ng cache
- S·ª≠ d·ª•ng Redis cache v·ªõi key pattern: `book_stats_summary_{period}_{hash}`

#### Details API  
- Cache k·∫øt qu·∫£ 5 ph√∫t 
- Cache key pattern: `book_stats_details_{period}_{date}_{limit}`
- Invalidate cache khi c√≥ order m·ªõi ƒë∆∞·ª£c confirm

### üìù Logging & Monitoring

#### Key Metrics
- API response time
- Cache hit/miss rate  
- Number of data points returned
- Top requested periods
- Error rates by period type

---

## 6. Error Handling

### ‚ùå C√°c l·ªói th∆∞·ªùng g·∫∑p

#### Summary API
```json
// Custom period thi·∫øu date range
{
  "status": 400,
  "message": "Custom period requires fromDate and toDate",
  "data": null
}

// Date range kh√¥ng h·ª£p l·ªá  
{
  "status": 400,
  "message": "fromDate must be less than toDate",
  "data": null
}

// Kho·∫£ng c√°ch qu√° l·ªõn
{
  "status": 400, 
  "message": "Date range cannot exceed 2 years",
  "data": null
}
```

#### Details API
```json
// Thi·∫øu required parameters
{
  "status": 400,
  "message": "period and date are required",
  "data": null
}

// Period kh√¥ng h·ª£p l·ªá
{
  "status": 400,
  "message": "period must be one of: day, week, month, year", 
  "data": null
}

// Limit v∆∞·ª£t qu√° gi·ªõi h·∫°n
{
  "status": 400,
  "message": "limit must be between 1 and 100",
  "data": null
}
```

--- 